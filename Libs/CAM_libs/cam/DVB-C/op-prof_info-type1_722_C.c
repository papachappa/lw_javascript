/* ----------------------------------------------------------------------------    
 * Copyright Digital TV Labs 2012 - 2013    
 * ---------------------------------------------------------------------------- */ 
#include <picoc_cit.h>
 
/* op_nit_7007_C */
uint8 op_nit_7007_C[945] = {
0x40,0xF3,0xB2,0x00,0x87,0xC1,0x00,0x00,0xF0,0x11,0x40,0x04,0x44,0x54,0x56,0x4C,0x4A,0x09,0x00,0x02,0x00,0x86,0x00,0x03,0x02,0x32,0x33,0xF3,0x94,0x00,0x01,0x00,0x86,0xF3,0x65,0x44,0x0B,0x04,0x74,0x00,
0x00,0xFF,0xF2,0x05,0x00,0x68,0x75,0x0F,0x5F,0x04,0x00,0x00,0x00,0x40,0xCC,0x0F,0x10,0x64,0x01,0xC0,0x64,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x30,0xCC,0x0F,0x10,0x65,0x01,0xC0,0x65,0x04,0x44,
0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x31,0xCC,0x0F,0x10,0x66,0x01,0xC0,0x66,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x32,0xCC,0x0F,0x10,0x67,0x01,0xC0,0x67,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,
0x30,0x33,0xCC,0x0F,0x10,0x68,0x01,0xC0,0x68,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x34,0xCC,0x0F,0x10,0x69,0x01,0xC0,0x69,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x35,0xCC,0x0F,0x10,0x6A,
0x01,0xC0,0x6A,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x36,0xCC,0x0F,0x10,0x6B,0x01,0xC0,0x6B,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x37,0xCC,0x0F,0x10,0x6C,0x01,0xC0,0x6C,0x04,0x44,0x54,
0x56,0x4C,0x04,0x43,0x31,0x30,0x38,0xCC,0x0F,0x10,0x6D,0x01,0xC0,0x6D,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x30,0x39,0xCC,0x0F,0x10,0x6E,0x01,0xC0,0x6E,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,
0x30,0xCC,0x0F,0x10,0x6F,0x01,0xC0,0x6F,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x31,0xCC,0x0F,0x10,0x70,0x01,0xC0,0x70,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x32,0xCC,0x0F,0x10,0x71,0x01,
0xC0,0x71,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x33,0xCC,0x0F,0x10,0x72,0x01,0xC0,0x72,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x34,0xCC,0x0F,0x10,0x73,0x01,0xC0,0x73,0x04,0x44,0x54,0x56,
0x4C,0x04,0x43,0x31,0x31,0x35,0xCC,0x0F,0x10,0x74,0x01,0xC0,0x74,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x36,0xCC,0x0F,0x10,0x75,0x01,0xC0,0x75,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x37,
0xCC,0x0F,0x10,0x76,0x01,0xC0,0x76,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x38,0xCC,0x0F,0x10,0x77,0x01,0xC0,0x77,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x31,0x39,0xCC,0x0F,0x10,0x78,0x01,0xC0,
0x78,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x30,0xCC,0x0F,0x10,0x79,0x01,0xC0,0x79,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x31,0xCC,0x0F,0x10,0x7A,0x01,0xC0,0x7A,0x04,0x44,0x54,0x56,0x4C,
0x04,0x43,0x31,0x32,0x32,0xCC,0x0F,0x10,0x7B,0x01,0xC0,0x7B,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x33,0xCC,0x0F,0x10,0x7C,0x01,0xC0,0x7C,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x34,0xCC,
0x0F,0x10,0x7D,0x01,0xC0,0x7D,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x35,0xCC,0x0F,0x10,0x7E,0x01,0xC0,0x7E,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x36,0xCC,0x0F,0x10,0x7F,0x01,0xC0,0x7F,
0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x37,0xCC,0x0F,0x10,0x80,0x01,0xC0,0x80,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x32,0x38,0xCC,0x0F,0x10,0x81,0x01,0xC0,0x81,0x04,0x44,0x54,0x56,0x4C,0x04,
0x43,0x31,0x32,0x39,0xCC,0x0F,0x10,0x82,0x01,0xC0,0x82,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x30,0xCC,0x0F,0x10,0x83,0x01,0xC0,0x83,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x31,0xCC,0x0F,
0x10,0x84,0x01,0xC0,0x84,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x32,0xCC,0x0F,0x10,0x85,0x01,0xC0,0x85,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x33,0xCC,0x0F,0x10,0x86,0x01,0xC0,0x86,0x04,
0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x34,0xCC,0x0F,0x10,0x87,0x01,0xC0,0x87,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x35,0xCC,0x0F,0x10,0x88,0x01,0xC0,0x88,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,
0x31,0x33,0x36,0xCC,0x0F,0x10,0x89,0x01,0xC0,0x89,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x37,0xCC,0x0F,0x10,0x8A,0x01,0xC0,0x8A,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x38,0xCC,0x0F,0x10,
0x8B,0x01,0xC0,0x8B,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x33,0x39,0xCC,0x0F,0x10,0x8C,0x01,0xC0,0x8C,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x30,0xCC,0x0F,0x10,0x8D,0x01,0xC0,0x8D,0x04,0x44,
0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x31,0xCC,0x0F,0x10,0x8E,0x01,0xC0,0x8E,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x32,0xCC,0x0F,0x10,0x8F,0x01,0xC0,0x8F,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,
0x34,0x33,0xCC,0x0F,0x10,0x90,0x01,0xC0,0x90,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x34,0xCC,0x0F,0x10,0x91,0x01,0xC0,0x91,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x35,0xCC,0x0F,0x10,0x92,
0x01,0xC0,0x92,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x36,0xCC,0x0F,0x10,0x93,0x01,0xC0,0x93,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x37,0xCC,0x0F,0x10,0x94,0x01,0xC0,0x94,0x04,0x44,0x54,
0x56,0x4C,0x04,0x43,0x31,0x34,0x38,0xCC,0x0F,0x10,0x95,0x01,0xC0,0x95,0x04,0x44,0x54,0x56,0x4C,0x04,0x43,0x31,0x34,0x39,0x00,0x02,0x00,0x86,0xF0,0x23,0x44,0x0B,0x05,0x06,0x00,0x00,0xFF,0xF2,0x05,0x00,
0x68,0x75,0x0F,0x5F,0x04,0x00,0x00,0x00,0x40,0xCC,0x0E,0x00,0x03,0x01,0x3F,0xFF,0x04,0x44,0x54,0x56,0x4C,0x03,0x65,0x70,0x67
};

/* CIS string = $compatible[ciplus=1 ciprof=0x00000001]$ */
uint8 CisData[170] =
{
	/* CISTPL_DEVICE_OA - L=6 */
	0x1D, 0x04, 0x00, 0xDB, 0x08, 0xFF,

	/* CISTPL_DEVICE_OC - L=5 */
	0x1C, 0x03, 0x00, 0x08, 0xFF,

	/* CISTPL_VERS_1 - L=48+2+17+1 */
	0x15,  /*  CISTPL_VERS_1           Level 1 version/product */
	0x42,  /*  Tuple link          Link to next tuple */
	0x05,  /*  TPLLV1_MAJOR           Major revision number */
	0x00,  /*  TPLLV1_MINOR           Minor revision number */
	'S','m','a','r','D','T','V', /* 7 characters */
	0x00,
	'D','V','B',' ','C','A',' ','M','o','d','u','l','e',  /* 13 characters */
	0x00,
	'$','c','o','m','p','a','t','i','b','l','e','[','c','i','p','l','u','s','=','1',
	' ','c','i','p','r','o','f','=','0','x','0','0','0','0','0','0','0','1',']','$',
	0x00,
	0xFF,  /* End of tuple */

	/* CISTPL_MANFID - L=6 */
	0x20, 0x04, 0xFF, 0xFF, 0x01, 0x00,

	/* CISTPL_CONFIG - L=23 */
	0x1A, 0x15, 0x01, 0x0F, 0xFE, 0x01, 0x01, 0xC0, 0x0E, 0x41, 0x02,
	'D','V','B','_','C','I','_','V','1','.','0','0', /* 12 Characters */

	/* CISTPL_CFTABLE_ENTRY (Address 0x320): Length:19 */
	0x1B, 0x11, 0xC9, 0x41, 0x19, 0x37, 0x55, 0x4E, 0x5E, 0x1D, 0x56,
	0xAA, 0x60, 0x90, 0x01, 0x03, 0x50, 0xFF, 0xFF,

	/* CISTPL_CFTABLE_ENTRY ( Address 0x000 for DVB) - L=40 */
	0x1B, 0x26, 0xCF, 0x04, 0x19, 0x37, 0x55, 0x4D, 0x5D, 0x1D, 0x56,
	0x22, 0x20, 0xC0, 0x09, 'D','V','B','_','H','O','S','T', 0x00,
	0xC1, 0x0E, 'D','V','B','_','C','I','_','M','O','D','U','L','E',
	0x00,

	/* CISTPL_NO_LINK - L=2 */
	0x14, 0x00,

	/* CISTPL_END L=1 */
	0xFF
};

int main(void)
{
   uint32 eError;
   cit_op_OperatorStatusBody stStatusBody_now; 
   uint8 u8NitVersion;
   cit_op_NitBuffer stNitBuffer;
   cit_op_OperatorInfo stOpInfo;
   uint8 op_tune_0000_X[2] = {0x00, 0x00};


   printf("[BOLD]OP op-prof_info-type1_722_C Start \n");


   /* status_body_0102_C */
   stStatusBody_now.u8InfoVersion = cit_op_GetInfoVersion() + 1;
   stStatusBody_now.u8NitVersion = (((cit_op_GetNitVersion() + 1) % 32) == 0) ? 1 : (cit_op_GetNitVersion() + 1); 
   stStatusBody_now.u8ProfileType = 0x1;
   stStatusBody_now.u8InitialisedFlag = 0x1;
   stStatusBody_now.u8EntChangeFlag  = 0x0;
   stStatusBody_now.u8EntValidFlag  = 0x1;
   stStatusBody_now.u8RefreshRequestFlag  = 0x0;
   stStatusBody_now.u8ErrorFlag  = 0x0;
   stStatusBody_now.u8DeliverySystemHint  = 0x1;
   stStatusBody_now.u16RefreshRequestDate = 0x0000;
   stStatusBody_now.u8RefreshRequestTime = 0x00;      
   /* set status_buffer_now */
   cit_op_SetOperatorStatusNow(&stStatusBody_now);
   /* set status_buffer_after_search */
   cit_op_SetOperatorStatusAfterSearch(&stStatusBody_now);
 
   /* op_nit_7007_C */
   u8NitVersion = stStatusBody_now.u8NitVersion; /* +1 already done above */
   memcpy(stNitBuffer.au8NitBuffer, op_nit_7007_C, sizeof(op_nit_7007_C));
   stNitBuffer.au8NitBuffer[5] |= ((u8NitVersion << 1) & 0x3E); /* update correct Nit Version */
   strncpy(stNitBuffer.au8NitLabel, "op_nit_7007_C", 16); /* set nit_label */
   stNitBuffer.au8NitLabel[16] = '\0';
   stNitBuffer.u16NitSize = sizeof(op_nit_7007_C);
   /* set nit_buffer_now */
   cit_op_SetNitBufferNow(&stNitBuffer);
   /* set nit_buffer_after_search */
   cit_op_SetNitBufferAfterSearch(&stNitBuffer);


 
   /* op_info_0722 */  
   stOpInfo.u8InfoValid = 0x1;
   stOpInfo.u8InfoVersion = stStatusBody_now.u8InfoVersion;
   stOpInfo.u16OrigNetID = 0x0085;
/* stOpInfo.u32Identifier - set by CAM code */
   stOpInfo.u8CharCodeTable = 0x00;
/* stOpInfo.u8EncodingTypeID - n/a
   stOpInfo.u8SecondByteValue - n/a
   stOpInfo.u8ThirdByteValue - n/a */
   stOpInfo.u8SdtRunStatTrusted = 0x0;
   stOpInfo.u8EitRunStatTrusted = 0x0;
   stOpInfo.u8EitPresentFollUsage = 0x1;
   stOpInfo.u8EitScheduleUsage = 0x3;
   stOpInfo.u8ExtendedEventUsage = 0x0;
   stOpInfo.u8SdtOtherTrusted = 0x0;
   stOpInfo.u8EitEventTrigger = 0x1;
   stOpInfo.u32Iso639LangCode = 0x756E64;
   stOpInfo.u8ProfileNameLen = 0x14;
   strcpy(stOpInfo.au8ProfileName, "Initial_DTVL_Profile");
   /* set operator_info */  
   cit_op_SetOperatorInfo(&stOpInfo);


   /* set empty delivery system descriptor loop - op_tune_0000X  */
   cit_op_SetDeliveryDscrLoop(op_tune_0000_X);

   cit_op_EnableDisableOpResource(1);
   
   /* set CIS string */
   eError = cit_sys_SetAppCIS(CisData, sizeof(CisData)); 
   if(0 != eError)
   {
      printf("[BOLD]Set App CIS eError: %d \n", eError); 
   }    
   
   printf("[BOLD]OP script done\n"); 
   return 0;
}

main(); 